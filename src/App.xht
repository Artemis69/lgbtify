<script>
const canvas = document.createElement('canvas');
let output, avatar;

const drawCanvas = (picture) => {
    const image = new Image();

    image.addEventListener('load', () => {

        canvas.width = image.width;
        canvas.height = image.height;

        const ctx = canvas.getContext("2d");

        ctx.clearRect(0, 0, canvas.width, canvas.height)
        ctx.drawImage(image, 0, 0);

        const flag = new Image()

        flag.addEventListener('load', () => {
            ctx.globalAlpha = 0.6;
            ctx.drawImage(flag, 0, 0, image.width, image.height);
            output = canvas.toDataURL("image/png", 1.0)
        })

        flag.src = picture;
        // flag.src = 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iODAwIiBoZWlnaHQ9IjQ4MCIgdmlld0JveD0iMCAwIDgwMCA0ODAiPgogIDxnIGZpbGwtcnVsZT0iZXZlbm9kZCI+CiAgICA8cmVjdCB3aWR0aD0iODAwIiBoZWlnaHQ9IjE5MiIgZmlsbD0iI2Q2MDI3MCIvPgogICAgPHJlY3Qgd2lkdGg9IjgwMCIgaGVpZ2h0PSI5NiIgeT0iMTkyIiBmaWxsPSIjOWI0Zjk2Ii8+CiAgICA8cmVjdCB3aWR0aD0iODAwIiBoZWlnaHQ9IjE5MiIgeT0iMjg4IiBmaWxsPSIjMDAzOGE4Ii8+CiAgPC9nPgo8L3N2Zz4='
        // flag.src = 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA3NzcgNDgwIj4KCTxyZWN0IGZpbGw9IiM3NTA3ODciIHdpZHRoPSI3NzciIGhlaWdodD0iNDgwIi8+Cgk8cmVjdCBmaWxsPSIjMDA0ZGZmIiB3aWR0aD0iNzc3IiBoZWlnaHQ9IjQwMCIvPgoJPHJlY3QgZmlsbD0iIzAwODAyNiIgd2lkdGg9Ijc3NyIgaGVpZ2h0PSIzMjAiLz4KCTxyZWN0IGZpbGw9IiNmZmVkMDAiIHdpZHRoPSI3NzciIGhlaWdodD0iMjQwIi8+Cgk8cmVjdCBmaWxsPSIjZmY4YzAwIiB3aWR0aD0iNzc3IiBoZWlnaHQ9IjE2MCIvPgoJPHJlY3QgZmlsbD0iI2U0MDMwMyIgd2lkdGg9Ijc3NyIgaGVpZ2h0PSI4MCIvPgo8L3N2Zz4='
        
    }, false);

    image.src = avatar;
}

const readFile = e => new Promise(resolve => {
    const file = e.target.files[0]

    if (!file) return;

    const reader = new FileReader();

    reader.addEventListener('load', (e) => {
        resolve(e.target.result)
    })

    reader.readAsDataURL(file);
});

const changeHandler = async (event) => {
    avatar = await readFile(event);
    drawCanvas('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA3NzcgNDgwIj4KCTxyZWN0IGZpbGw9IiM3NTA3ODciIHdpZHRoPSI3NzciIGhlaWdodD0iNDgwIi8+Cgk8cmVjdCBmaWxsPSIjMDA0ZGZmIiB3aWR0aD0iNzc3IiBoZWlnaHQ9IjQwMCIvPgoJPHJlY3QgZmlsbD0iIzAwODAyNiIgd2lkdGg9Ijc3NyIgaGVpZ2h0PSIzMjAiLz4KCTxyZWN0IGZpbGw9IiNmZmVkMDAiIHdpZHRoPSI3NzciIGhlaWdodD0iMjQwIi8+Cgk8cmVjdCBmaWxsPSIjZmY4YzAwIiB3aWR0aD0iNzc3IiBoZWlnaHQ9IjE2MCIvPgoJPHJlY3QgZmlsbD0iI2U0MDMwMyIgd2lkdGg9Ijc3NyIgaGVpZ2h0PSI4MCIvPgo8L3N2Zz4=')
};

</script>

<input type="file" accept="image/png, image/jpeg" @change:changeHandler />
<img src={output} alt="">
